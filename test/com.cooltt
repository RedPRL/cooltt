def mycoe/fun : {
  (A : (i : dim) -> univ) (B : (i: dim) -> univ)
  (coe/A : (r : dim) (x : A r) (i : dim) -> sub {A i} {i==r} x)
  (coe/B : (r : dim) (x : B r) (i : dim) -> sub {B i} {i==r} x)
  (r : dim) (f : (_ : A r) -> B r) (i : dim) ->
  sub {(_ : A i) -> B i} {i==r} f
} = {
 \A B coe/A coe/B r f i x =>
 coe/B r {f {coe/A i x r}} i
}

def mycom/fun : {
  (A : dim -> univ)
  (B : dim -> univ)
  (com/A : (r : dim) (phi : cof) (p : (i : dim) (_ : [{i==r} \/ phi]) -> A i) (i : dim) -> sub {A i} {{i==r} \/ phi} {p i _})
  (com/B : (r : dim) (phi : cof) (p : (i : dim) (_ : [{i==r} \/ phi]) -> B i) (i : dim) -> sub {B i} {{i==r} \/ phi} {p i _})
  (r : dim) (phi : cof) (p : (i : dim) (_ : [{i==r} \/ phi]) (_ : A i) -> B i) (i : dim) -> sub {(_ : A i) -> B i} {{i==r} \/ phi} {p i _}
} = {
  \A B com/A com/B r phi p r' x =>
  com/B r phi {\j _ => p j _ {com/A r' {1==0} {\_ _ => x} j}} r'
}

normalize mycom/fun

def coe/intro : {
  (A : dim -> univ) (r : dim) (r' : dim) (x : A r) ->
  sub {A r'} {r==r'} x
} = {
 \A r r' x => coe A r r' x
}

def coe/fun : {
  (A : dim -> univ) (B : dim -> univ)
  (r : dim) (r' : dim)
  (f : {A r} -> B r) ->
  sub {{A r'} -> B r'} {0==0} {\x => coe B r r' {f {coe A r' r x}}}
} = {
 \A B r r' f =>
 coe {\i => {A i} -> B i} r r' f
}

normalize coe/fun
