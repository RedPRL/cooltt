def mycoe/fun
  (A : (i : ğ•€) â†’ type) (B : (i: ğ•€) â†’ type)
  (coe/A : (r : ğ•€) (x : A r) (i : ğ•€) â†’ sub {A i} {i=r} x)
  (coe/B : (r : ğ•€) (x : B r) (i : ğ•€) â†’ sub {B i} {i=r} x)
  (r : ğ•€) (f : (_ : A r) â†’ B r) (i : ğ•€)
  : sub {(_ : A i) â†’ B i} {i=r} f
  =
  x â‡’
  coe/B r {f {coe/A i x r}} i

def mycom/fun
  (A : ğ•€ â†’ type)
  (B : ğ•€ â†’ type)
  (com/A : (r : ğ•€) (Ï† : ğ”½) (p : (i : ğ•€) (_ : [i=r âˆ¨ Ï†]) â†’ A i) (i : ğ•€) â†’ sub {A i} {i=r âˆ¨ Ï†} {p i _})
  (com/B : (r : ğ•€) (Ï† : ğ”½) (p : (i : ğ•€) (_ : [i=r âˆ¨ Ï†]) â†’ B i) (i : ğ•€) â†’ sub {B i} {i=r âˆ¨ Ï†} {p i _})
  (r : ğ•€) (Ï† : ğ”½) (p : (i : ğ•€) (_ : [i=r âˆ¨ Ï†]) (_ : A i) â†’ B i) (i : ğ•€)
  : sub {(_ : A i) â†’ B i} {i=r âˆ¨ Ï†} {p i _}
  =
  x â‡’
  com/B r Ï† {j _ â‡’ p j _ {com/A i #f {_ _ â‡’ x} j}} i

normalize mycom/fun

def coe/intro (A : ğ•€ â†’ type) (r : ğ•€) (r' : ğ•€) (x : A r) : sub {A r'} {r=r'} x =
 coe A r r' x

def coe/pi
  (A : ğ•€ â†’ type) (B : (i : ğ•€) â†’ A i â†’ type)
  (r : ğ•€) (r' : ğ•€)
  (f : (x : A r) â†’ B r x)
  : sub {(x : A r') â†’ B r' x} #t {x â‡’ coe {i â‡’ B i {coe A r' i x}} r r' {f {coe A r' r x}}}
  =
  coe {i â‡’ (x : A i) â†’ B i x} r r' f

normalize coe/pi

def coe/sigma
  (A : ğ•€ â†’ type) (B : (i : ğ•€) â†’ A i â†’ type)
  (r : ğ•€) (r' : ğ•€)
  (p : (x : A r) Ã— B r x)
  : sub {(x : A r') Ã— B r' x} #t [coe A r r' {fst p}, coe {i â‡’ B i {coe A r i {fst p}}} r r' {snd p}]
  =
  coe {i â‡’ (x : A i) Ã— B i x} r r' p

normalize coe/sigma

def coe/pathd
  (A : ğ•€ -> ğ•€ -> type)
  (r : ğ•€)
  (r' : ğ•€)
  (a : (i : ğ•€) -> A i 0)
  (b : (i : ğ•€) -> A i 1)
  (m : pathd {A r} {a r} {b r})
  : sub {pathd {A r'} {a r'} {b r'}} #t {j â‡’
      com {i â‡’ A i j} r r' {âˆ‚ j} {i p â‡’
        [j=0 â‡’ a i | j=1 â‡’ b i | i=r â‡’ m j]
      }
    }
  =
  coe {i â‡’ pathd {A i} {a i} {b i}} r r' m

normalize coe/pathd

def hcom/intro
  (A : type) (r : ğ•€) (r' : ğ•€) (Ï† : ğ”½)
  (p : (i : ğ•€) (_ : [i=r âˆ¨ Ï†]) â†’ A)
  : sub A {r=r' âˆ¨ Ï†} {p r' _}
  =
  hcom A r r' Ï† p

def hcom/fun
  (A : type) (B : type) (r : ğ•€) (r' : ğ•€) (Ï† : ğ”½)
  (p : (i : ğ•€) (_ : [i=r âˆ¨ Ï†]) â†’ A â†’ B)
  : sub {A â†’ B} #t {x â‡’ hcom B r r' Ï† {j _ â‡’ p j _ x}}
  =
  hcom {A â†’ B} r r' Ï† p

normalize hcom/fun

def com/intro
  (A : ğ•€ â†’ type) (r : ğ•€) (r' : ğ•€) (Ï† : ğ”½)
  (p : (i : ğ•€) (_ : [i=r âˆ¨ Ï†]) â†’ A i)
  : sub {A r'} {r=r' âˆ¨ Ï†} {p r' _}
  =
  com A r r' Ï† p

normalize com/intro

def com/decomposition
  (A : ğ•€ â†’ type) (r : ğ•€) (r' : ğ•€) (Ï† : ğ”½)
  (p : (i : ğ•€) (_ : [i=r âˆ¨ Ï†]) â†’ A i)
  : sub {A r'} #t {hcom {A r'} r r' Ï† {j _ â‡’ coe A j r' {p j _}}}
  =
  com A r r' Ï† p
