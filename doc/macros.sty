\microtypesetup{
  activate={true,nocompatibility},final,kerning=true,spacing=true,factor=1100
}

\RequirePackage{chngpage}
\RequirePackage{jon-ebproof}
\RequirePackage{mathtools}
\RequirePackage{jmsdelim}
\RequirePackage{jon-todo}
\RequirePackage{ebproof}
\RequirePackage{favonia-symbols}
\RequirePackage{pifont} % dingbats

\RequirePackage{silence}
\WarningFilter{remreset}{The remreset package}
\RequirePackage{thmtools,thm-restate}

\NewDocumentCommand\Sl{smm}{\IfBooleanTF{#1}{\prn{#2}}{#2}_{/#3}}
\NewDocumentCommand\CatEl{mm}{#1 / #2}

\NewDocumentCommand\Yo{s o g}{%
  \YoSym\IfValueT{#2}{_{#2}}%
  \IfValueT{#3}{%
    \IfBooleanTF{#1}{
      \parens{#3}
    }{#3}
  }%
}

\NewDocumentCommand\Lan{mG{}}{\mindelim{1}\operatorname{Lan}_{#1}#2}

\DeclareMathOperator\Ob{ob}
\DeclareMathOperator\Lim{lim}
\DeclareMathOperator\Colim{colim}
\NewDocumentCommand\Coend{mm}{{\textstyle\int}^{#1}{#2}}

\RequirePackage{xcolor}
\definecolor{Matterhorn}{RGB}{77,77,77}
\definecolor{RegalBlue}{RGB}{3,69,117}
\definecolor{RedDevil}{RGB}{134,1,17}
\definecolor{Revolutionary}{RGB}{150,40,16}

\NewDocumentCommand\SetupFleuron{m}{
  \AtBeginEnvironment{#1}{%
    \renewcommand\qedsymbol{\ding{166}}%
    \pushQED{\qed}%
  }%
  \AtEndEnvironment{#1}{\popQED}%
}


\AtEndPreamble{%
  \theoremstyle{definition}
  \newtheorem{slogan}[theorem]{Slogan}
  \newtheorem{caveat}[theorem]{Caveat}
  \newtheorem{notation}[theorem]{Notation}
  \newtheorem{remark}[theorem]{Remark}
  \newtheorem{fact}[theorem]{Fact}
  \newtheorem{construction}[theorem]{Construction}
  \newtheorem{assumption}[theorem]{Assumption}

  \let\c@equation\c@theorem

  \SetupFleuron{fact}
  \SetupFleuron{caveat}
  \SetupFleuron{slogan}
  \SetupFleuron{definition}
  \SetupFleuron{proposition}
  \SetupFleuron{notation}
  \SetupFleuron{construction}
  \SetupFleuron{remark}
  \SetupFleuron{example}
  \SetupFleuron{assumption}
}

\NewDocumentCommand\SET{}{\mathbf{Set}}
\NewDocumentCommand\CAT{}{\mathbf{Cat}}
\NewDocumentCommand\TOPOS{}{\mathfrak{Topos}}
\NewDocumentCommand\LOGOS{}{\mathfrak{Logos}}

\NewDocumentCommand\Comma{mm}{#1\downarrow{}#2}
\NewDocumentCommand\ECat{}{\mathcal{E}}
\NewDocumentCommand\BCat{}{\mathcal{B}}
\NewDocumentCommand\CCat{}{\mathcal{C}}
\NewDocumentCommand\DCat{}{\mathcal{D}}
\NewDocumentCommand\XCat{}{\mathcal{X}}
\NewDocumentCommand\FCat{}{\mathcal{F}}

\NewDocumentCommand\ThCat{}{\mathbb{T}}
\NewDocumentCommand\Repr{G{\ThCat}}{\mathcal{R}_{#1}}
\NewDocumentCommand\Simplex{m}{\mathbf{\Delta}^{#1}}
\NewDocumentCommand\Hom{omm}{\IfValueT{#1}{#1}\brackets{#2,#3}}
\NewDocumentCommand\ArrCat{m}{\Hom{\Simplex{1}}{#1}}
\NewDocumentCommand\CartArr{m}{\Hom{\Simplex{1}}{#1}_{\mathit{cart}}}
\NewDocumentCommand\ObjTerm{m}{\mathbf{1}_{#1}}
\NewDocumentCommand\ArrId{m}{\mathbf{id}_{#1}}


\NewDocumentCommand\Point{m}{\vphantom{#1}\smash{\overset{\lower.3em\hbox{\Large\bfseries .}}{#1}}}

\NewDocumentCommand\TY{}{\mathbf{T}}
\NewDocumentCommand\EL{}{\Point{\mathbf{T}}}
\NewDocumentCommand\El{}{\boldsymbol{\tau}}
\NewDocumentCommand\ElMor{}{\Mor[\El]{\EL}{\TY}}

\NewDocumentCommand\AltTY{}{\mathbf{S}}
\NewDocumentCommand\AltEL{}{\Point{\mathbf{S}}}
\NewDocumentCommand\AltEl{}{\boldsymbol{\varsigma}}
\NewDocumentCommand\AltElMor{}{\Mor[\AltEl]{\AltEL}{\AltTY}}

\NewDocumentCommand\CElMor{}{\Mod{\CCat}{\parens{\ElMor}}}

\NewDocumentCommand\UTY{}{\mathbf{U}}
\NewDocumentCommand\UEL{}{\Point{\mathbf{U}}}
\NewDocumentCommand\UEl{}{\mathbf{el}_{\UTY}}
\NewDocumentCommand\UMor{}{\Mor[\UEl]{\UEL}{\UTY}}

\NewDocumentCommand\EUTY{}{\mathbf{U}_{\ECat}}
\NewDocumentCommand\EUEL{}{\Point{\mathbf{U}}_{\ECat}}
\NewDocumentCommand\EUEl{}{\mathbf{el}_{\EUTY}}
\NewDocumentCommand\EUMor{}{\Mor[\EUEl]{\EUEL}{\EUTY}}

\NewDocumentCommand\GlUTY{}{\GlFun{\TY}}
\NewDocumentCommand\GlUEL{}{\GlFun{\EL}}
\NewDocumentCommand\GlUEl{}{\GlFun{\El}}
\NewDocumentCommand\GlUMor{}{\Mor[\GlUEl]{\GlUEL}{\GlUTY}}




\NewDocumentCommand\OpCat{sm}{\IfBooleanTF{#1}{\parens{#2}}{#2}^{\mathsf{op}}}


\NewDocumentCommand\Psh{m}{
  \mathbf{Pr}\parens{#1}
}

\NewDocumentCommand\Sh{m}{
  \mathbf{Sh}\parens{#1}
}

\NewDocumentCommand\Fib{}{\mathbf{Fib}}
\NewDocumentCommand\DF{g}{
  \mathbf{DF}\IfValueT{#1}{_{#1}}
}

\NewDocumentCommand\ModCat{G{\ThCat}}{\mathbf{Mod}_{#1}}
\NewDocumentCommand\Mod{smG{\mathscr{M}}}{
  \IfBooleanTF{#1}{
    #3^{#2}
  }{
    #3_{#2}
  }
}

\NewDocumentCommand\IMod{sG{\mathscr{M}}}{
  \IfBooleanTF{#1}{
    #2^{\ICCat}
  }{
    #2_{\ICCat}
  }
}
\NewDocumentCommand\GlMod{sG{\mathscr{M}}}{
  \IfBooleanTF{#1}{
    #2^{\CptGlCat}
  }{
    #2_{\CptGlCat}
  }
}
\NewDocumentCommand\ReprAdj{m}{\mathbf{q}_{#1}}





\NewDocumentCommand\CptIncl{g}{\mathsf{K}\IfValueT{#1}{\parens{#1}}}
\NewDocumentCommand\GlCat{}{\mathcal{G}}
\NewDocumentCommand\GlProj{g}{\mathsf{gl}\IfValueT{#1}{\parens{#1}}}
\NewDocumentCommand\GlUnProjL{g}{\emptyset_{\mathsf{gl}}\IfValueT{#1}{\parens{#1}}}
\NewDocumentCommand\GlUnProjR{g}{\mathbf{I}_{\mathsf{gl}}\IfValueT{#1}{\parens{#1}}}

\NewDocumentCommand\CptGlProj{g}{\mathsf{gl}_{\CptIncl}\IfValueT{#1}{\parens{#1}}}
\NewDocumentCommand\CptGlCat{}{\GlCat_{\CptIncl}}
\NewDocumentCommand\GlRl{G{-}}{\verts{#1}_{\CptIncl}}
\NewDocumentCommand\GlNv{g}{\mathsf{N}_{\CptIncl}\IfValueT{#1}{\parens{#1}}}


\NewDocumentCommand\GlDom{m}{\mathsf{E}_{#1}}
\NewDocumentCommand\F{g}{F\IfValueT{#1}{\prn{#1}}}
\NewDocumentCommand\FC{g}{F_{\CCat}\IfValueT{#1}{\prn{#1}}}
\NewDocumentCommand\IHom{mm}{{#1}\Rightarrow{#2}}



\RequirePackage{stmaryrd}

\ExplSyntaxOn
\NewDocumentCommand\floors{+O{}sm}{
  \keys_set:nn {jmsdelim} {#1}
  \jmsdelim_make:nnnn {#2} \lfloor\rfloor {#3}
}
\NewDocumentCommand\ceils{+O{}sm}{
  \keys_set:nn {jmsdelim} {#1}
  \jmsdelim_make:nnnn {#2} \lceil\rceil {#3}
}
\NewDocumentCommand\pparens{+O{}sm}{
  \keys_set:nn {jmsdelim} {#1}
  \jmsdelim_make:nnnn {#2} \llparenthesis\rrparenthesis {#3}
}
\ExplSyntaxOff

\let\brk\brackets
\let\prn\parens
\let\brc\braces


\NewDocumentCommand\TskU{}{\mathbf{u}}
\NewDocumentCommand\TskDec{}{\mathbf{dec}}

\NewDocumentCommand\ElTskEL{}{\Point{\mathbf{U}}}
\NewDocumentCommand\ElTskU{}{\mathbf{U}}
\NewDocumentCommand\ElTskEl{}{\boldsymbol{\varpi}}

%% ???
\NewDocumentCommand\GTskU{}{\GlFun{\TskU}}
\NewDocumentCommand\GTskDec{}{\GlFun{\TskDec}}

\NewDocumentCommand\ETskEL{}{\Point{\mathsf{u}}_{\mathcal{E}}}
\NewDocumentCommand\ETskU{}{\mathsf{u}_{\mathcal{E}}}
\NewDocumentCommand\ETskDec{}{\mathsf{dec}_{\mathcal{E}}}




\NewDocumentCommand\PI{G{\bullet}}{\mindelim{1}#1^{\Pi}}
\NewDocumentCommand\SG{G{\bullet}}{\mindelim{1}#1^{\Sigma}}

\DeclareMathSymbol{\ii}{\mathalpha}{letters}{"10}

\NewDocumentCommand\TyPi{g}{\mathbf{pi}}
\NewDocumentCommand\TySg{g}{\mathbf{sg}}
\NewDocumentCommand\TmLam{g}{\mathbf{lam}}
\NewDocumentCommand\TmPair{g}{\mathbf{pair}}
\NewDocumentCommand\CodePi{g}{\mindelim{1}\widehat{\mathbf{p\ii}}}
\NewDocumentCommand\CodeSg{g}{\mindelim{1}\widehat{\mathbf{sg}}}


\NewDocumentCommand\RCat{}{\mathcal{R}}
\NewDocumentCommand\RCxFun{g}{\epsilon\IfValueT{#1}{\prn{#1}}}
\NewDocumentCommand\RNv{g}{\mathsf{N}_{\RCxFun}\IfValueT{#1}{\prn{#1}}}


\NewDocumentCommand\LNfSym{}{\mathbf{L}}
\NewDocumentCommand\RNfSym{}{\mathbf{R}}

\NewDocumentCommand\LNfEL{}{\LNfSym_{\EL}}
\NewDocumentCommand\RNfEL{}{\RNfSym_{\EL}}
\NewDocumentCommand\LNfEl{}{\LNfSym_{\El}}
\NewDocumentCommand\RNfEl{}{\RNfSym_{\El}}
\NewDocumentCommand\VarEL{}{\mathbf{V}_{\EL}}
\NewDocumentCommand\VarEl{}{\mathbf{V}_{\El}}

\NewDocumentCommand{\ICCat}{}{\mathcal{I}}
\NewDocumentCommand\frk{m}{\mathfrak{#1}}
\NewDocumentCommand\code{m}{\texttt{#1}}

\NewDocumentCommand\Sat{m}{\underline{#1}}
\NewDocumentCommand\Reify{m}{\mindelim{1}\mathord{\downarrow}_{#1}}
\NewDocumentCommand\Reflect{m}{\mindelim{1}\mathord{\uparrow}_{#1}}

\NewDocumentCommand\NfLam{}{\code{lam}}
\NewDocumentCommand\NfApp{}{\code{app}}
\NewDocumentCommand\NfPair{}{\code{pair}}
\NewDocumentCommand\NfSplit{}{\code{split}}
\NewDocumentCommand\NfFst{}{\code{fst}}
\NewDocumentCommand\NfSnd{}{\code{snd}}
\NewDocumentCommand\NfVar{}{\code{var}}
\NewDocumentCommand\NfId{}{\code{id}}


\NewDocumentCommand\GlFun{G{-}}{\GlCat\brk{#1}}
\NewDocumentCommand\GlFunCell{sG{\bullet}}{\IfBooleanTF{#1}{\overline{\boldsymbol{\chi}}}{\boldsymbol{\chi}}_{#2}}

\NewDocumentCommand\EMP{}{\diamond}


\NewDocumentCommand\MathSmall{m}{\mbox{\scriptsize $#1$}}
